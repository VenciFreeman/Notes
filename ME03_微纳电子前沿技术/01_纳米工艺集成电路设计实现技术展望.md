# 纳米工艺集成电路设计实现技术展望

**主讲**：[毛志刚]( http://ic.sjtu.edu.cn/ic/faculty/maozhigang/ )

[TOC]

## 问题的提出：摩尔定律还能走多远

### 摩尔定律

- 集成电路集成度每18-24个月翻一番
  - 集成度每三年提高4倍，加工特征尺寸缩小$\sqrt{2}$倍
  - 集成度提升，性能随之提升
- 不是自然规律，是行业对技术发展趋势的期望和规划
- 按照摩尔定律发展的半导体工艺技术带来了**加工成本成指数降低**，使信息技术的普及成为可能。
- 实现摩尔定律的代价：巨额资本投入
- 摩尔定律难以维系：将导致整个集成电路行业和信息产业**发展模式的变化**
- 集成电路具有**不可替代性**，需要寻找后续发展的出路

### 目前趋势

> 已经过了发展的指数增长期

#### 工艺提升速度

- 速度变缓：不再是1.5年一代

  - 台积电：目前5nm量产
  - Intel：10nm，但其效果与台积电7nm相当
  - 三星：7nm，5nm即将量产
  - Global Foundries：10nm
  - UMC：14nm，随后因为晋华被调查而中止
  - SMIC：14nm，7nm预计2021年前后可以推向市场(但EUV光刻机禁运，采用其他方法)

#### 经济回报
  - 过去：晶体管成本下降 (22nm前成立)
  - 现实：晶体管成本下降的规律不复存在
    - 目前工艺越提升，成本下降越来越小 (工艺越来越复杂)
    - 现在量大不一定能再降低成本


### 问题

> 后面的器件如何维持性能提升幅度和收回成本赢得利润？

- 受制于物理规律，工艺提升变慢，并且终将走向尽头 (1nm可行)
- 工艺尺寸的缩小变得越来越复杂，成本不降反升
- 更小尺寸的器件可以提升性能，但幅度变小 (每代30%)
- 需要更大量产品才能收回投入

### 各大厂商观点

#### Intel

- 钟摆式发展
  - 一半的时间进行工艺提升
  - 一半的时间进行体系结构优化
- 2029年做到1.4 nm (但实际目前10 nm仍然停摆)

#### TSMC

- 5nm于2019年3月开始风险试产，今年第二季度大批量生产
  - 只面向苹果，AMD等大公司 (华为也占据少量产能)
- 与7nm比较
  - 逻辑密度增加1.8倍，SRAM缩放0.75(最能说明问题)，模拟缩放约0.85
  - 等功耗速度增益15% (相同速度下功耗低30%)
- 明年推出N5P性能版本，相同功耗下性能提升7%
- 将会推出高迁移率沟道(HMC)晶体管
  - 低电阻触点和通孔;金属间距略微宽松，通孔更宽
  - 晶体管的变种包括一个1.5V或1.2V的I/O晶体管和一个速度比7纳米等效器件快25％的极限LVT器件
  - 可用的112Gbps SerDes

## 工艺技术趋势：3-5nm工艺下的器件实现

### 器件如何制作

- 传统晶体管 (Planar)
- FinFET (14nm ==> 5nm)
  - 栅三面环绕沟道，有效关断沟道，减小漏电流
- Nanowire/Nanoribbon
  - 四面环绕
  - 不再用平面硅技术，而采用多个纳米线/片代替 (GAA)
- FinFET 3D Stacking
  - 四面环绕
- Nanowire/Nanoribbon 3D Stacking
- Stacked 2D-Material Transistors

![Fig1](https://github.com/VenciFreeman/Notes/blob/master/fig/ME03_chapter01_fig01.jpg)

![Fig2](https://github.com/VenciFreeman/Notes/blob/master/fig/ME03_chapter01_fig02.jpg)

### FinFET的困境与出路

#### 困境

- 有“平面”晶体管没有的设计缺陷
  - 实现速度、功耗、复杂性和成本之间的权衡与沟道宽度有关，而FinFET沟道宽度需要统一(连接晶体管形成电路的金属互连线成层排布在晶体管之上)
    - 宽长比不能调整，灵活性欠佳
    - 并排多个鳍的成本也更高
  - 仅三面环绕矩形硅鳍，底部与硅体相连，晶体管关闭时仍然有漏电流
    - 要实现对沟道区域的终极控制，栅极需要完全将其环绕

#### 出路

- 环绕栅技术(GAA)
  - 堆叠纳米线增大有效晶体管宽度
  
  ![未来的晶体管](https://github.com/VenciFreeman/Notes/blob/master/fig/ME03_chapter01_fig03.jpg)
  
  - 局限性
    - 只能叠同样高度的叠层且不能太高，否则会干扰互连层
    - 每增加一条纳米线就会扩大器件的电容，减慢晶体管的开关速度
    - 制造极细纳米线颇为复杂，边缘往往很粗糙，会阻碍电荷载流子的速度
    
  - 纳米片实现CAA
  
    - 由堆叠纳米片制成的晶体管实际上能比占相同芯片面积的FinFET提供更多的电力
    - 恢复了过渡到FinFET时失去的灵活性：纳米片可以加宽来增加电流，也可以缩窄来降低功耗
    - 关键在于构造超晶格 (硅锗两种材料组成的周期性层状晶体)
    - 选择性蚀刻锗硅，对硅不做处理
  
    ![如何制备纳米片](https://github.com/VenciFreeman/Notes/blob/master/fig/ME03_chapter01_fig04.jpg)
  
- 集成度会进一步提升
  
  - 2030年之前可能达到1nm
  
- 性能也会进一步提升

## 非工艺因素：成本与复杂度

- 器件结构和工艺过程太复杂，几何要求太精细，参数离散性加大，良率问题突出 (7nm刚刚达到稳定)
- 版图设计、器件模型与平面工艺差别很大，需要考虑的因素更复杂
- 产品设计导入需要设计、生产企业和EDA供应商共同参与完成
- 晶体管数量大，物理设计与验证工作量陡增
- 专业人才稀缺，成为限制产品种类和从业企业数量的瓶颈
- IP核研制技术难度大，知识产权资源难以寻觅
- 市场规模大的产品类别越来越少
- 研发投入过大
  - 设计成本随工艺节点指数增长
    - Xinlinx的一个28nm工艺的FPGA产品研发到生产需要$170m
    - 10nm工艺的产品研发大概$500m
  - 生产成本随光刻层数增加显著
    - 多次曝光增加工艺加工成本

### 小结

- 工艺上可以做到纳米级晶体管，需要考虑如何做好
- 做小的芯片，用封装集成为更大的系统
  - 3D封装
  - Chiplet技术
- 运算能力足够，但数据访存带宽不够
  - 扩大存储器带宽
  - 设计专用芯片
- 设计工作量大、复杂
  - 仿真加速
  - 人工智能

## Chiplet和3D封装技术

### 为什么要多片封装

- 为满足更大功耗散热，芯片面积和功耗成比例增加
- 大芯片突出问题是成品率低，成品率随芯片面积指数下降，低成品率意味着高成本付出
  - 4个10×10良率比1个20×20良率提高29%
- 解决思路
  - 一个大的芯片分为几个小的芯片实现，再组装成同样功能的系统 (System in a package, SiP)，即增加封装成本换取整体成本的降低
  - SiP是继SoC后封装层面快速、低成本实现系统芯片的方案
  - 其他优点
    - 组成更加灵活，比如不同核数、不同存储容量
    - 可以根据不同性能要求、采用不同工艺的小芯片组成系统，降低成本，丰富功能

### Chiplet

#### 概述

- Chiplet基板是一颗工艺节点大、面积大、能做底盘的新型芯片，由于是完整的芯片，设计师可以自定义芯片方案
- 基片可以用于链接，同时通过实现路由功能 (router)在基板上完成类片上的网络互联
- 基板上还可以实现基于开关的稳压电源
- 因为成本低，所以不需要担心先进工艺下的各种非理想效应/能量存储的大容量片上电容

#### 要素

- 英伟达的旗舰GPU从100mm<sup>2</sup>，开始指数级发展，这样下去性能提升将受限于面积
  - Volta架构GPU/GV100的面积率先突破800mm<sup>2</sup>
  - 新的Ampere系列GPU将在7nm工艺实现面积达到826mm<sup>2</sup>
- 异构集成系统提供了一种新的设计方案
  - 产品中的不同组件在独立的裸片上设计和实现，称为chiplet
  - 不同的裸片可以使用不同的工艺节点制造，甚至可以由不同的供应商提供
  - 第三方chiplet可以减少设计时间和成本
- 但可行性常受到片间互连的性能和可用性的限制，片间互连的功耗和性能比片内互连要糟糕3-4个数量级。这需要强制进行高带宽访问的资源
- 各大公司已经开发出了自己封闭的高度并行的高速串行接口，来改进片间连接的电源效率。新的封装技术已被开发，来支持这些不同接口的多芯片封装
- 一些组织开始考虑建立行业开放的Chiplet标准，包括物理层和协议层

## 运算带宽和IO技术

### 处理器存储结构

- SerDes DDR：带宽约1Tbps量级
- 内部总线：带宽约10Tbps量级
- 运算能力：TFlops
- 数据吞吐率：$3Tword/s×32bit=12TB/s=96Tbps$

### 芯片带宽需求和现实

> 28纳米工艺的案例来分析

- 28纳米工艺下，最复杂的GPU (CPU)芯片面积都在200mm2以上，已经是保障成品率的上限面积；芯片的运算能力在256GFlops (每秒标准浮点运算数)，主频1-4GHz，功耗100-200W
- 芯片集成的存储器包括Cache、寄存器等；Cache存储器占据50%以上面积，容量达到极限的数百MB水平
- IO采用10Gbps SerDes，最多达到2-4路32bit (1.2Tbps)。外部存储器：DDR3 (8-16GB/s)
- 按照上述情况计算
  - 芯片内部计算单元需要的数据量是$256×32×2Gbps=16Tbps$
  - 假设Cache速率是$1G×32b=32Gb$，一个Cache吞吐率只有$32G/16T=1/512$
  - 不可能集成512个Cache，只能通过寄存器缓存大量需要计算的数据；但1/500还是一个很大的差距
  - I/O (SerDes)只能满足$10G×4×32=1.2Tbps$也只能满足运算数据1/10的吞吐率

### 如何再提升

- 工艺到7纳米后，集成度提升将近5-8倍 (非16倍)，但芯片面积也增大了2-4倍，总体的运算能力 (主频不增加时与集成度成正比)提升10-30倍
- IO的通道数受封装限制无法增加太多 (比如1倍)，要匹配前面提到的1/10运算能力的IO吞吐率，IO速率要提升5-15倍
- 最新的GPU：10TFlops，DDR带宽5.6Tbps (HBM2)
- 首先，IO速率严格受限于工艺
  - 目前14纳米可以做到56Gbps，7纳米争取做到112Gbps (比28nm提升5倍)
  - 高速IO的功耗随速率上升很快，占到芯片功耗的20%以上
  - 目前研发倾向于采用光传输降低功耗 (硅光技术)
- 其次，可以拉近存储器和处理器的距离，同时扩展存储器的带宽
  - 采用3D封装技术，将存储器和处理器封装在一起。芯片距离近了，可以降低Ser Des/DDR功耗
  - 封装在一起的存储器和处理器IO个数可以不在局限于封装外管脚个数的限制，通过增加存储器IO可以进一步扩大带宽 (如HBM技术)
  - 做针对应用的专用加速协处理器，针对性地优化存储组织和访存机制，如AI芯片、存算一体化

### 硅光案例

- TeraPHY小芯片与采用AIB接口和Intel EMIB硅桥封装的Intel FPGA共同封装，成功地用高效的光信号接口取代了先进现场可编程门阵列 (FPGA)的传统电I/O—电串行器/解串器 (SERDES)小芯片。这些SERDES小芯片可在需要快速数据移动时补偿有限的I/O，从而实现高速通信和其他功能
- TeraPHY小芯片采用GlobalFoundries 45nm工艺制造，能够支持每秒2 Terabits (Tbps)的I/O带宽，功耗只是电I/O的一小部分

### HBM

- 高密度TSV的重要应用产品是高带宽存储器（HBM）。通过高密度TSV技术垂直互连方式，将多个DDR芯片堆叠在一起后和CPU/GPU封装在一起，形成大容量，高位宽的DDR组合阵列提升存储器容量和性能
- 固态存储协会（JEDEC）发布第三版HBM2存储标准JESD235C，将针脚带宽提高到3.2Gbps
- 按照设计规范，单Die最大2GB、单堆栈12 Die（无标准高度限制），也就是24GB容量，匹配1024bit位宽，单堆栈理论最大带宽410GB/s。对于支持四堆栈（4096bit）的图形芯片来说，总带宽高达1.64TB/s

## 变革设计方法学

### 依靠设计方法变革提升设计能力

- 传统设计方法变革主要是提升设计效率
- 当前的面临的问题除效率还有成本：时间/人工成本、加工成本

### 高层次综合

- 需要花大力气对代码重构才能达到好的性能，简单的C代码在综合得到硬件后甚至可能比CPU性能慢上百倍，可通过编译优化技术来解决这个问题，因此开发了一个编译器Merlin，简化代码重构工作。体系结构设计的“三大法宝”为并行、流水和缓存。Merlin编译器的目标是将“三大法宝”对应的设计规则集成到编译器中，从而在整个过程中减少人的参与
- 如何在很大的设计空间中找到优化设计也是一个很大的挑战。具体设计时每一个法宝都有很多种选择，因此设计空间很大。为了应对这个问题，开发了一套自动化设计空间探索框架（Automated design space exploration framework）。目前还主要是基于梯度进行空间搜索，这方面还有很大的优化空间

### 快速仿真验证技术

- 业界一直在使用硬件验证加速器做快速原型验证
  - 使用多个FPGA阵列
  - 将设计的原型综合到FPGA阵列上，可以进行实时功能验证
  - 验证原型节拍级的功能正确性，无法保证时序正确性
- 目前业界开始使用阵列服务器做硬件仿真器
  - 采用GPU/FPGA做硬件计算加速器，配合服务器做硬件运算加速。
  - 可以完成类SPACE的后仿真，速度是一般仿真器无法比拟的
- 新型的形式验证工具

### 敏捷设计技术：快速设计案例

- UCSD开展高效开源EDA工具链的研究——DARPA IDEA项目：24小时内全自动地完成IP、SoC芯片、PCB版的设计
- 该项目从四个维度来应对芯片设计复杂度问题
  - 将大的设计尽可能划分为小模块，一方面是降低算法复杂度，另一方面就是更易挖掘并行性
  - 并行优化，与前面最大化划分密切联想，当存在大量并行度时，就可以采用各种加速并行的技术来优化，包括使用GPU来加速
  - 采用机器学习的工具与流程，传统芯片设计流程中有很多经验规则，这一点可以通过训练大量已有设计变成神经网络模型，从而加速最优电路设计的搜索和预测
  - 受限的布局方案也可以减少布局布线时的算法复杂度
- 这是一个开源工具

### 开源案例：RISC-V

- ISA是规范标准；微结构设计是具体实现，对应的是源代码；产品则是设计的实例化
- 将指令集标准与架构设计分为三类：Open & Free、Licensable、Closed
  - Intel属于封闭指令集+封闭设计
  - ARM属于可授权指令集+可授权设计，但需要上百万甚至数千万美元
  - RISC-V为全世界提供了开放免费指令集+开放免费设计的选择
- 基于开源开放指令集（比如RISC-V），也存在三种不同的商业模式
  - Google、NVidia等在内部大量使用RISC-V核作为MCU，但他们不对外开放IP以及源代码
  - SiFive公司、中国台湾晶心Andes、阿里平头哥的RISC-V核是可以被授权给第三方使用，但并不开源RTL级源码
  - Berkeley的Rocket Chip、剑桥大学的LowRISC、蜂鸟E203等RISC-V核将RTL级源码也开源

> 开源联盟
>
> CHIPS联盟——这是近期Google联合了6家企业成立了一个开源芯片联盟，旨在推动开源芯片生态。这7家企业每一家都贡献了开源芯片设计中所需要的功能模块，例如西部数据的SweRV核、SiFive的Rocket核、Google的RISC-V-DV验证工具等。越来越多的开源工具开始出现，未来基于全开源EDA工具设计开源芯片，将不会是空谈

### 技术手段小结

- 加速设计、减少研发周期
  - 采用硬件加速仿真和验证
  - 采用人工智能算法实现某些步骤设计
- 降低设计成本
  - 采用开源模块
- 实现复杂芯片设计
  - 引入新的行为描述语言
  - 针对某些领域开展高层次综合
  - 新的形式验证方法