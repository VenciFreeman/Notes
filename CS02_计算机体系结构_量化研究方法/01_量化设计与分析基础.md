# 01_量化设计与分析基础

[toc]

## 引言

### 计算机飞速发展的四大效果

- 显著增强可供计算机用户使用的功能
- 性价比大幅提高，新型计算机出现
- 基于微处理器的计算机在整个计算机设计领域中占主导地位
  - 体系结构方面的创新
  - 技术改进的高效运用
- 对软件开发的影响
  - 以性能换取生产效率
  - 应用程序的本质也在变化

```
处理器性能的提高从单纯依赖指令级并行(ILP)转向数据级并行(DLP)和线程级并行(TLP)
```

## 计算机的分类

|       特征        |       关键的系统设计问题       |
| :---------------: | :----------------------------: |
|   个人移动设备    |  成本、能耗、媒体性能、响应率  |
|      台式机       |     性价比、能耗、图形性能     |
|      服务器       | 吞吐量、可用性、可扩展性、能耗 |
| 集群/仓库级计算机 |   性价比、吞吐量、能耗均衡性   |
|      嵌入式       |   价格、能耗、应用的特有性能   |

### 个人移动设备

> 带有多媒体用户界面的无线设备

- 概述
  - 成本是关键因素
  - 虽然强调能效，但散热较差，限制总功耗
  - 能耗与尺寸要求决定采用闪存而非磁盘
- 多媒体应用程序关键特性
  - 响应性能
  - 可预测性性能
- 应用程序的其他关键特性
  - 减少存储器占用
    - 重视存储器用量需要重视代码规模
  - 高效利用能量

### 台式机

- 价格与性能有更好的性价比
  - 性能：计算性能与图形性能

### 服务器

> 提供更大规模、更可靠的文件和计算服务，大规模企业计算的中枢

- 需求
  - 可靠性
    - 故障造成的损失非常严重
  - 可拓展性
    - 满足服务增长需求或功能增长需求
    - 计算容量、内存、存储器和I/O带宽的扩展能力
  - 高吞吐能力
    - 整体性能 (总体效率和成本效益)最为重要
    - 单位时间能够处理的请求数

### 集群/仓库级计算机

> 集群：一组桌面计算机或服务器通过局域网连接在一起，每个节点都运行自己的操作系统，节点间使用网络协议进行通信

- 性价比与功耗非常关键
- 仓库级计算机 (WSC)与服务器的相通之处在于都看重可靠性
  - 服务器
    - 可扩展性通过集成计算机硬件实现
  - WSC
    - 可扩展性通过连接计算机的局域网实现
- 仓库级计算机与超级计算机的相通之处在于昂贵
  - 超算
    - 强调浮点性能
    - 紧耦合性需要非常快速的内部网络
  - WSC
    - 重视互动应用程序
    - 需要大规模存储、可靠性和高带宽

### 嵌入式计算机

> 日用电器、网络交换机等中包含简单的嵌入式微处理器

- 能否运行第三方软件是区分嵌入式和非嵌入式计算机的分界线
- 处理能力和成本差别巨大
- 主要目标是以最低价格满足性能需要

### 并行度与并行体系结构的分类

- 主要约束条件：能耗和成本
- 应用程序中主要的并行
  - 数据级并行 (DLP)
    - 同时操作许多数据项
  - 任务级并行 (TLP)
    - 创建能够单独处理但大量采用并行方式执行的工作任务
- 开发应用并行的主要方式
  - 指令级并行
    - 在编译器的帮助下、利用流水线等思想开发数据级并行
    - 利用推理执行等思想开发中等水平的数据级并行
  - 向量体系结构与图形处理器
    - 将单条指令并行应用于数据级，以开发数据级并行
  - 线程级并行
    - 在紧耦合硬件模型中开发数据级并行或任务型并行
    - 允许在并行线程之间进行交互
  - 请求级并行
    - 在手动或操作系统指定的大量去耦合任务之间开发并行
- 按照多处理器最受约束组件中指令流和数据流并行区分计算机
  - 单指令流、单数据流 (SISD)
    - 单处理器，看作标准顺序计算机
  - 单指令流、多数据流 (SIMD)
    - 同一指令由多个使用不同数据流的处理器执行
    - 每个处理器都有自己的数据存储器，但只有一个指令存储器和控制处理器
  - 多指令流、单数据流 (MISD)
  - 多指令流、多数据流 (MIMD)
    - 针对任务级并行，每个处理器都提取自己的指令、对自己的数据进行操作
    - 比SIMD更灵活，适用性也更强，但开销更高

## 计算机体系结构的定义

### 指令集体系结构

> 指令集体系结构 (ISA)指代程序员可以看到的实际指令集，作用是区分软件和硬件的界限

#### ISA分类

> 几乎均划分到通用寄存器体系结构中

- 寄存器-存储器ISA：在许多指令中访问存储器
  - 80x86：16个通用寄存器和16个通常存入浮点数据的寄存器
- 载入-存储ISA：只能通过载入或存储指令访问存储器
  - MIPS：32个通用寄存器和32个浮点寄存器

#### 寻址

> 几乎所有桌面计算机和服务器计算机都使用字节寻址来访问存储器操作数
>
> 操作数对齐、访问速度更快

##### 寻址模式

- 寄存器寻址
- 立即数寻址
  - 用于常数寻址
- 位移量寻址
  - 无寄存器 (绝对数)
  - 两个寄存器 (用位移量 基址寻址)
  - 两个寄存器 (一个寄存器内容乘以操作数的字节大小，用比例索引和位移量进行变址寻址)
    - 减去位移量字段再加上寄存器间接寻址、基址寻址和变址寻址

#### 操作数的类型和大小

- 8位 (ASCII)
- 16位 (Unicode或半个字)
- 32位 (整数或字)
- 64位 (双字或长整型)
- 32位 (单精度)和64位 (双精度)的IEEE 754浮点数
- 80位浮点 (扩展双精度，80x86支持)

#### 操作指令和控制流指令

- 常见操作类别
  - 数据传输指令
  - 算术逻辑指令
  - 控制指令
  - 浮点指令
- 控制流指令：均使用相对于PC的寻址方式
  - 条件转移
    - MIPS条件分支检查寄存器中的内容
    - 80x86和ARM分支测试条件代码位
      - 在执行算术、逻辑运算时置位
  - 无条件跳转
    - ARM和MIPS过程调用将返回地址放在一个寄存器中
    - 80x86调用将返回地址放在存储器中的一个栈内
  - 过程调用和返回

#### ISA编码

- 两种基本的编码选择
  - 固定长度
    - ARM和MIPS指令均为32位，简化指令译码
      - 后来支持扩展，支持长16位的指令以便缩小程序规模 (Thumb, Thumb-2, MIPS16)
  - 可变长度
    - 80x86为可变长度，变化范围为1-18个字节，占用较少的空间
- 编码选择会影响将指令转换为二进制编码的方式

### 满足目标和功能需求的组成和硬件

## 技术趋势

### 性能趋势：带宽胜过延迟

### 晶体管性能与连线的发展

## IC功率和能耗趋势

### 系统观点

### 微处理器内部的能耗和功率

## 成本趋势

### 时间、产量和大众化的影响

### 集成电路成本

### 成本与价格

### 制造成本与运行成本

## 可信任度

## 性能的测量、报告和汇总

### 基准测试

### 报告性能测试结果

### 性能结果汇总

## 计算机的量化原理

### 充分利用并行

### 局域性原理

### 重点关注常见情形

### Amdahl定律

### 处理器性能公式

## 性能、价格和功耗

## 谬论与易犯错误